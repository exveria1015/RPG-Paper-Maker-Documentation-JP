# バトルシステム

RPG を作成する場合、バトルシステムが必要になる場合があります。ここでは、バトルの実装に関連するすべての機能を見ていきます。

![](../.gitbook/assets/battle-demo.gif)

_注意: アクション RPG（マップ上で直接バトルを行う）を作成する場合は、オブジェクトとイベントを使用して行うことができます。_

## バトルシステムデータ <a href="#battle-system-datas" id="battle-system-datas"></a>

多くのバトルシステムデータは、`システムマネージャー> バトルシステム` にあります。

![](<../.gitbook/assets/battle-system (1).png>)

## 属性 <a href="#elements" id="elements"></a>

![](../.gitbook/assets/elements.png)

ここでは、ダメージ効果に影響を与えるためにゲームに持たせたいすべての属性を管理できます。

* `名前`: ゲーム UI に表示される名前。
* `アイコン`: ゲーム UI に表示されるアイコン。
* **効率性**: ここでは、現在の属性が他のすべての既存の属性に対してどの程度効果的であるかを編集できます。これは、属性がクラスに割り当てられている場合に非常に役立ちます。デフォルトでは、x1.0（通常の効果）です。

## 共通ステータス <a href="#common-statistics" id="common-statistics"></a>

![](../.gitbook/assets/battle-statistic.png)

ここでは、バトルに影響を与えるためにゲームに持たせたいすべてのステータス（HP、レベル、強さなど）を管理できます。

* `名前`: ゲーム UI に表示される名前。
* `スクリプトの省略形`: ここで省略形を選択します。これはゲームスクリプトに使用されます。可能な場合は、大文字を使用しないようにしてください。
* **プロパティ**:
  * `固定値`: チェックを入れると、このステータスは固定値（バーではない）になります。
  * `バー`: チェックを入れると、このステータスはバー値（実際の値+最大値）になります。

## 共通バトルコマンド <a href="#common-battle-commands" id="common-battle-commands"></a>

![](../.gitbook/assets/battle-commands.png)

ヒーローを選択して何かを実行した後に、どのバトルコマンドを使用するかを選択します。

* `スキル`: 対応するスキルを選択します。

ゲームでのレンダリング:

![](../.gitbook/assets/battle-commands-preview.png)

## 共通装備 <a href="#common-equipment" id="common-equipment"></a>

共通装備の名前を選択して、これらの装備スロットに武器/防具を装備できるようにします。

## 武器/防具の種類 <a href="#weapons-armors-kind" id="weapons-armors-kind"></a>

![](../.gitbook/assets/battle-weapon-armor-kind.png)

武器/防具の種類を作成し、どの装備に割り当てることができるかを選択します。

* `名前`: この種類の武器/防具の名前。
* 割り当てることができる装備の選択。

## バトルマップ <a href="#battle-maps" id="battle-maps"></a>

![](../.gitbook/assets/battle-maps.png)

バトルマップは、実際には、特定の位置（バトルの中心点を表す）に関連付けられたマップです。マップ（デフォルトではマップセレクターの `Battle Maps` フォルダー内）と位置を選択して、新しいバトルマップを追加します。

## ステータス関連付け <a href="#statistics-associations" id="statistics-associations"></a>

* `レベルに関連付けられたステータス`: レベルに関連付ける固定ステータスのいずれかを選択します。レベルは、キャラクターの進化に伴って増加するステータスです。レベルアップすると、他のステータスも増加します。
* `経験値に関連付けられたステータス`: 経験値に関連付けるバーステータスのいずれかを選択します。経験値は、一般的にバトル終了後に獲得されます。経験値が最大値に達すると、キャラクターはレベルアップし、マップの経験値バーも増加します。

## 式 <a href="#formulas" id="formulas"></a>

* `死亡`: キャラクターが死亡したとみなす条件を定義する JavaScript の式。`u` はキャラクターに対応します。
* `クリティカルの影響`: クリティカルヒットが発生した後、新しいダメージ値を定義する JavaScript の式。`damage` は、クリティカルの影響を受けないダメージに対応します。
* `ヒーローのバトラーの中心からのオフセット`: マップバトルの中心に対するヒーローのバトラーの位置を定義する JavaScript の式。
* `ヒーローのバトラーのオフセット`: 他のヒーローの位置に対するヒーローのバトラーの位置を定義する JavaScript の式（`i` はヒーローのインデックス）。
* `敵のバトラーの中心からのオフセット`: マップバトルの中心に対する敵のバトラーの位置を定義する JavaScript の式。
* `敵のバトラーのオフセット`: 他の敵の位置に対する敵のバトラーの位置を定義する JavaScript の式（`i` は敵のインデックス）。

## バトル音楽 <a href="#battle-musics" id="battle-musics"></a>

* `バトル`: バトル中に使用されるバトル音楽。
* `レベルアップ`: ヒーローがレベルアップしたときに使用されるサウンド。
* `勝利`: 勝利のバトル終了フェーズで使用される音楽。

## 通貨 <a href="#currencies" id="currencies"></a>

`システムマネージャー> システム` に移動します。

![](<../.gitbook/assets/currencies (1).png>)

通貨は、NPC との取引など、ゲーム内で使用できます。

* `名前`: 通貨の名前。
* `アイコン`: 通貨に関連付けられたアイコン。

## スキル/アイテム/武器/防具 <a href="#skills-items-weapons-armors" id="skills-items-weapons-armors"></a>

`データマネージャー` に移動します。

`スキル` タブ:

![](<../.gitbook/assets/skills (2).png>)

`アイテム` タブ:

![](../.gitbook/assets/items.png)

`武器` タブ:

![](../.gitbook/assets/weapons.png)

`防具` タブ:

![](../.gitbook/assets/armors.png)

これらの4つのデータには、共通のプロパティがあります。

* `名前`: データの名前。
* `種類`: アイテム/防具/武器の種類を選択します。
* `消耗品`: チェックを入れると、データを使用した後にデータが消えます。
* `片手`: _まだ利用できません。_
* `アイコン`: データに関連付けられたアイコン。
* `説明`: ゲーム内に表示されるデータの説明。
* `条件式`: スキル/アイテム/武器/防具を装備または使用できるようにするための条件。
* `対象`: 関連する効果を適用する対象。
  * `なし`: 対象を選択しません。
  * `使用者`: 使用者のみを選択します。
  * `敵1体`: 敵を1体だけ選択します。
  * `味方1体`: 味方を1体だけ選択します。
  * `敵全体`: すべての敵を選択します。
  * `味方全体`: すべての味方を選択します。
* `対象条件式`: 対象に応じてスキル/アイテム/武器/防具を使用できるようにするための条件。
* `使用可能`: データの使用可能な種類。
  * `バトルのみ`: データはバトルでのみ使用できます。
  * `メインメニューのみ`: データはメインメニューでのみ使用できます。
  * `常に`: データはバトルとメインメニューの両方で使用できます。
  * `使用不可`: データは使用できません。
* `サウンド（メインメニュー）`: メインメニューで使用するときに再生するサウンド。
* `使用者アニメーションID`: 攻撃前に使用者に表示するアニメーションID。
* `対象アニメーションID`: 攻撃時に対象に表示するアニメーションID。
* `売却可能`: ショップでアイテムを販売できるかどうかを示します。
* `バトルメッセージ`: スキルまたはアイテムの使用時に上部のバーに表示されるメッセージ。 `[item]` はアイテム名を表示し、`[skill]` はスキル名を表示します。
* `価格`: ショップメニューで購入/販売できる場合のデータの価格。

さらに、`コスト`、`効果`、`特性` の3つの共通プロパティをリストすることができます。

## コスト <a href="#costs" id="costs"></a>

![](../.gitbook/assets/battle-costs.png)

スキルの使用コストを選択します。これは一般的に、HP、MP、TPのステータスに使用されます。キャラクターは、使用コストに十分な値を持っていない場合、スキルを使用できません。

* `コストの適用対象`: スキルを使用した後に影響を受けるデータを選択します。 `ステータス`、`通貨`、または `変数` を選択できます。
  * `値`: 選択したデータに必要な値を選択します。

## 効果 <a href="#effects" id="effects"></a>

![](../.gitbook/assets/effects.png)

対象のデータに対して行われる効果を選択します。

* `ダメージ対象`: ダメージを与えるデータを選択します。 `ステータス`、`通貨`、または `変数` を選択できます。
  * `式`: 選択したデータのダメージ値を選択します。
  * `最小値`: 最終的なダメージの最小値。
  * `最大値`: 最終的なダメージの最大値
  * `属性ID`: このダメージに適用される属性。
  * `分散`: ダメージの分散（パーセント）。これはダメージにランダム性を追加します。たとえば、20％の分散を選択した場合、ダメージの範囲は次のようになります。\[ダメージ - （20 \* ダメージ / 100）| ダメージ + （20 \* ダメージ / 100）]。チェックを外すと、分散はありません（= 0）。
  * `クリティカル`: クリティカルヒットの確率（パーセント）。チェックを外すと、クリティカルヒットの確率はありません（= 0）。
  * `命中率`: 命中率（パーセント）。チェックを外すと、100％の確率で命中します。
  * `値の保存先`: ダメージ値を変数に保存できます。これは、たとえば、次の効果に使用できます。
* `ステータスの追加/削除`: 対象にステータスを追加または削除します。
* `スキルの追加/削除`: 対象にスキルを追加または削除します（習得または忘却）。
* `スキルの実行`: 対象に別のスキルを実行します。
* `共通リアクションの呼び出し`: 共通リアクションを呼び出します。
* `特殊行動`: 次の特殊行動のいずれかを実行します。
  * `武器の効果とプロパティを適用する`: 現在装備している武器のすべての効果を使用します。装備している武器がない場合は、この効果に続く次の効果が適用されます。
  * `スキル選択を開く`: バトルコマンドのスキル選択を開きます。
  * `アイテム選択を開く`: バトルコマンドのアイテム選択を開きます。
  * `逃げる`: バトルから逃げます。
  * `ターン終了`: チームのターンを終了します。
* `スクリプト`: スクリプトを実行します。
* `一時的に対象を変更する`: この効果に対してのみ、対象を一時的に変更できます。バトラーの配列を返す必要があります。例： `[u.battler]` はアイテム/スキル/武器の使用者になります。

## 特性 <a href="#characteristics" id="characteristics"></a>

装備時にキャラクターに追加される特性を選択します。

![](../.gitbook/assets/battle-characteristic-buff.png)

*   `バフの増加/減少`: 影響を受けるデータを選択します。これは次のとおりです。

    * `ステータス値`: ステータスを選択します。バーステータスの場合、これは最大値を増加させます。
    * `属性耐性`: 耐性を適用する属性を選択します。
    * `ステータス耐性`: 耐性を適用するステータスを選択します。
    * `経験値獲得率`: 各バトル後の経験値の獲得量を変更します。
    * `通貨獲得量`: 各バトル後の通貨の獲得量を変更します。
    * `スキルコスト`: スキルコストの変更を適用するスキルを選択します。

    データの影響を選択した後、ベース値に応じてこれがどのように影響を受けるかを選択できます。

    * `* / +`: 値を乗算するか加算するかを選択して演算を選択します。
    * `% / 固定値`: 単位値を選択します。

![](../.gitbook/assets/battle-characteristic-character-specific.png)

* `装備`: 武器または防具を装備することを許可または禁止することを選択します。
* `装備の変更`: 装備スロットを編集可能にすることを許可または禁止することを選択します。
* `初期装備`: 初期装備（プレイヤーがインスタンス化されたとき）を選択します。

![](../.gitbook/assets/battle-caracteristics-other.png)

* `スクリプト`: スクリプトを実行します。

## クラス <a href="#classes" id="classes"></a>

![](../.gitbook/assets/battle-classes.png)

各キャラクターはクラスを持っています。クラスは、キャラクターが持つことができる多くの属性を定義します。

* **経験値**: レベルに応じた経験値の進行を定義します。セルを `ダブルクリック` することで、経験値列を手動で編集できることに注意してください。
  * `次のレベルまで`: テーブルは、次のレベルに進むために獲得する必要がある経験値の数を示しています。
  * `合計`: テーブルは、次のレベルに進むために蓄積する必要がある経験値の合計数を示しています。
  * `初期レベル`: 可能な初期レベル。
  * `最大レベル`: 可能な最大レベル。
  * `ベース`: 初期レベルで持つ必要がある経験値の数。
  * `インフレーション`: ベースとレベルに応じて経験値の進行を変更するインフレーション値。
  * `リセット`: デフォルト値にリセットします。
* **ステータスの進行**: レベルアップ時のステータスの進行を変更します。
  * **情報**:
    * `ステータス`: システムステータスのいずれかを選択します。
    * `最大値`: 可能な最大値。アイテムによってボーナス値が追加される可能性があるため、これは必ずしも最終値に対応するわけではありません。
  * **固定値**:
    * `初期値`: 初期レベルでの初期値。
    * `最終値`: 最大レベルでの最終値。
    * `スライダーによる進行`:
      * `遅い`: 経験値は最初はゆっくりと増加し、最後は速く増加します。
      * `線形`: 経験値は一定に増加します。
      * `速い`: 経験値は最初は速く増加し、最後はゆっくりと増加します。
    * `ランダムな変動`: 進行関数に適用される分散。これは常に最大値につながることに注意してください。
  * **式**: 式を使用して値を定義します。`u` はキャラクターに対応します。
* **特性**: クラスの特性を定義します。
* **習得するスキル**: レベルに応じて習得できるスキルのリストを定義します。
  * `スキル`: 習得する対応するスキル。
  * `レベル`: このスキルを習得するレベル。

## ヒーロー <a href="#heroes" id="heroes"></a>

![](../.gitbook/assets/heroes.png)

* `クラス`: 既存のクラスを選択します。
* `説明`: ゲーム内のステータスメニューに表示される説明。
* `顔グラフィック`: バトル用の顔グラフィックを選択します。
* `バトラー`: バトル用のバトラーを選択します。

他のすべてのプロパティは、クラスのプロパティを継承します。 `経験値` については、デフォルト値はクラスの値です。 `クラスの値に設定` ボタンを押すと、値がクラスの値に更新されます。 `ステータスの進行` リストには、進行を追加できます。ステータスがすでに存在する場合、進行は置き換えられます。 `習得するスキル` リストには、習得するスキルを追加できます。スキルがすでに存在する場合、レベルは置き換えられます。

## モンスター <a href="#monsters" id="monsters"></a>

![](../.gitbook/assets/battle-monsters.png)

モンスターはヒーローとまったく同じですが、バトルに関する追加情報があります。

* **報酬**:

![](../.gitbook/assets/battle-monsters-rewards.png)

* `経験値`: バトル終了時にチームが獲得できる経験値を選択します。
* `通貨`: バトル終了時にチームが獲得できる通貨を選択します。
*   `戦利品`: バトル終了時にチームが獲得できる戦利品。

    * `数`: 戦利品として入手できるアイテムの数。
    * `確率`: 戦利品として入手できる確率。
    * `レベル範囲`: 戦利品として入手できるレベルの範囲を選択します。
    * `戦利品`: `アイテム`、`武器`、`防具` を選択します。


* **行動**:

ここで、モンスターのAIを管理できます。次のオプションを使用して、モンスターの行動を指定できます。

![](../.gitbook/assets/monster-action.png)

* `優先度`: 行動の優先度。`確率` を見ると、他のすべてのアクションの優先度に対するアクションの発生確率（パーセント）が表示されます。警告：変数として優先度を設定すると、 `?` が表示されます。
* `対象`:
  * `ランダム`: AIなしでランダムな対象を攻撃します。
  * `弱い敵`: HPの低い対象を攻撃します。警告：これが機能するようにするには、共通ステータスでHPの省略形を削除または変更しないでください。
* **行動**:
  * `スキルIDを使用`: モンスターは選択したスキルを使用します。
  * `アイテムIDを使用`: モンスターは選択したアイテムを使用します。
  * `最大数`: モンスターが使用できるアイテムの最大数。0未満の場合、無限になります。
  * `何もしない`: モンスターは何もしません。
* **条件**:
  * `ターン値`: この行動は、バトルの現在のターン数に応じて実行できます。
  * `ステータスID`: この行動は、指定されたステータスの割合に応じて実行できます。注：これはバー（最大値あり）のみである必要があります。
  * `変数`: この行動は、変数の現在の値に応じて実行できます。
  * `ステータスIDの効果を受けている`: まだ利用できません。
  * `スクリプト`: この行動は、スクリプトの戻り値に応じて実行できます。

## 部隊 <a href="#troops" id="troops"></a>

![](../.gitbook/assets/troops.png)

部隊は、モンスターのグループと、リアクションを伴ういくつかの状態に対応します。

* **テストボタン**: テストボタンを使用して、いつでも部隊の戦いをテストできます。この部隊と戦うチームを選択できる小さなウィンドウが開きます。完了したら、[OK]を押すと、選択した部隊とのゲームバトルが開きます。

![](../.gitbook/assets/troop-test.png)

* **モンスターリスト**:
  * `モンスター`: グループ内のモンスター。
  * `レベル`: モンスターのレベル。
* **リアクション**: このバトル部隊でトリガーするリアクションのリスト。
  * `名前`: リアクションの名前（すべてを整理するためにのみ使用）。
  * `条件`: リアクションをトリガーするために検証する条件:

![](../.gitbook/assets/troops-reactions.png)

*
  * `ターン数 + x`: ターン数。最初のターンはターン1です。（+）ターンは固定ベースターンであり、（x）はトリガーされる回数です。たとえば、 `1 + 2 x` はターン1、3、5 ...などでトリガーされます。
  *   `ヒーロー/モンスター全員/プレイヤーなし/少なくとも1人のプレイヤー/インスタンスIDを持つプレイヤー`:

      * `ステータスIDの効果を受けている`: ステータスが適用されているかどうかを確認します。
      * `ステータスIDを持っている`: ステータス値を比較します。


* `頻度`: トリガーの頻度。
  * `1回`: 最初のターンの開始時に1回だけトリガーされます。
  * `毎ターン（開始時）`: 各ターンの開始時にトリガーされます。
  * `毎ターン（終了時）`: 各ターンの終了時にトリガーされます。
  * `常に`: 各フレームでトリガーされます。

## ステータス <a href="#status" id="status"></a>

![](../.gitbook/assets/status.png)

ステータスは、特定のスキルやアイテムを使用した後に適用できます。これは、KO、毒、麻痺などです。

* `アニメーションID`: プレイヤーがこのステータスの影響を受けているときにループで表示するアニメーションを選択します。複数のステータスがある場合、プレイヤーに複数のアニメーションを表示することはできないため、 `優先度` によって表示するアニメーションが決まります。
* `制限`: ステータスの影響を受けているプレイヤーに制限を追加できます。これは次のとおりです。
  * `何もできない`: プレイヤーは毎回ターンをパスします。
  * `スキルを使用できない`: プレイヤーはスキルメニューを開くことができません。
  * `アイテムを使用できない`: プレイヤーはアイテムメニューを開くことができません。
  * `逃げられない`: プレイヤーは逃げることはできません。
  * `ランダムな対象を攻撃する`: プレイヤーはランダムな攻撃を使用して、ランダムな対象（味方または敵）を攻撃します。
  * `ランダムな味方を攻撃する`: プレイヤーはランダムな攻撃を使用して、ランダムな味方を攻撃します。
  * `ランダムな敵を攻撃する`: プレイヤーはランダムな攻撃を使用して、ランダムな敵を攻撃します。
* `優先度`: 表示する `アニメーションID` と `バトラーの位置` を定義します。複数のステータスがある場合、優先度の高い方が表示されます。
* `バトラーの位置`: プレイヤーがステータスの影響を受けているときに、バトラーの画像に表示する列。
* **解除条件**: すべてのステータス解除条件を定義します。
  * `バトル終了時に解除`: ステータスはバトル終了後に消えます。
  * `攻撃を受けた後、X％の確率で解除`: ステータスは攻撃を受けた後（正のダメージを受けた後）、X％の確率で消えます。
  * `ターン開始時に解除`: ステータスは、ターン数に応じた確率に依存する一連の条件に従って、ターン開始時に消えます。
* **メッセージ**: ステータスの状況に応じて表示するメッセージを定義します。
  * `味方が影響を受けた`
  * `敵が影響を受けた`
  * `ステータスが回復した`
  * `ステータスはまだ影響を受けている`
* **効果**: プレイヤーがまだステータスの影響を受けている場合に、ターン開始時に適用される効果。
* **特性**: プレイヤーがステータスの影響を受けているときに適用される特性（バフなど）。

## アニメーション <a href="#animations" id="animations"></a>

![](../.gitbook/assets/battle-animations.png)

アニメーションは、武器、スキル、アイテム、およびイベントコマンドのアニメーションを表示するために使用されます。これらの2Dアニメーションは、いくつかの異なるオプションを使用してカスタマイズできます。

* `画像`: アニメーション全体に使用されるテクスチャ。
* `位置`: 原点の位置を選択します。パネルに描画されたバトラーの例を使用して、この位置のインジケーターが表示されます。
* **フレーム**: アニメーションのさまざまなフレームのリスト。
  * **グラフィック**: 左クリックして、パネルに要素を追加できます。

![](../.gitbook/assets/widget-animation.png)

右クリックして `編集...` をクリックすると、要素のプロパティを編集できます。

![](../.gitbook/assets/widget-animation-element-properties.png)

* `インデックス`: 要素のインデックス。要素は常に、インデックスの低い他の要素の上に描画されます。
* `X`: 要素の中心のx位置。
* `Y`: 要素の中心のy位置。
* `ズーム`: 要素のズーム％。
* `角度`: 要素の角度°。
* `垂直方向に反転`: チェックを入れると、要素が垂直方向に反転します。
*   `不透明度`: 要素の不透明度％。

    左クリックする前に、このセレクターを使用してテクスチャを選択できます。

![](../.gitbook/assets/widget-animation-texture.png)

*   **オプション**:

    * `バトラーの変更`: パネルに表示するバトラーを変更します。
    * `フレームのコピー...`: 次のオプションを使用してフレームをコピーします。



    ![スクリーンショット](../.gitbook/assets/animation-copy-frames.png)



    * **コピーするフレーム**: コピーするすべてのフレームを選択します。
    * `貼り付け開始フレーム`: このフレームから貼り付けます。
    * `フレームのクリア...`: 次のオプションを使用してフレームをクリアします。



    ![スクリーンショット](../.gitbook/assets/animation-clear-frames.png)



    * `トランジションの作成...`: 次のオプションを使用して、複数のフレームにトランジションを作成します。



    ![スクリーンショット](../.gitbook/assets/animation-create-transition.png)



    * **フレーム**: トランジションの開始フレームと終了フレーム。
    * **要素インデックス**: トランジションを適用する要素のインデックス。
    * `X`、`Y`、`ズーム`、`角度`、`不透明度`: トランジション終了時のオプションの値。プログレススライダーを使用して、トランジションの速度を選択できます。
    * `テクスチャの適用`: 選択したテクスチャを選択した要素に適用します。
    * `ヒット時に再生`: ヒット時のアニメーションをテストします。
    * `ミス時に再生`: ミス時のアニメーションをテストします。
    * `クリティカル時に再生`: クリティカルヒット時のアニメーションをテストします。
    * `行`: テクスチャアニメーションを分割する行の数。デフォルト値は5です。
    * `列`: テクスチャアニメーションを分割する列の数。デフォルト値は5です。
* **効果音/フラッシュ**: ここに効果（効果音またはフラッシュ）のリストを追加できます。

![スクリーンショット](../.gitbook/assets/animation-effects.png)

* **効果**:
  * `効果音`: このフレームで再生するサウンドを選択します。
  * `フラッシュ`: _まだ利用できません。_
* `条件`: このサウンドを再生したり、このフラッシュを表示したりするための条件を選択します。
  * `なし`: 条件はありません。
  * `ヒット`: 攻撃がヒットしたとき。
  * `ミス`: 攻撃がミスしたとき。
  * `クリティカル`: クリティカルヒットが発生したとき。
